<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>TagHipster</title>
	<meta name="description" content="">
	<meta name="author" content="alex & ondrej">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" href="favicon.ico">
	<link rel="apple-touch-icon" href="apple-touch-icon.png">
	<link rel="stylesheet" href="Styles/style.css?v=2">
    <link rel="stylesheet" media="handheld" href="Styles/handheld.css?v=2">
	<script src="Scripts/modernizr-1.7.min.js" type="text/javascript"></script>


    <style>
        body
        {
            background-color: #dedede;
        }
    
        #ui > div
        {
            position: fixed;
        }

        ul
        {
            list-style: none;
        }
        
        #images
        {
            background: url(Images/shadow-top.png) #6b6b6b repeat-x bottom;
            top: 0;
            left: 0;
            right: 0;
            height: 100px;
        }
              
        #board
        {
            top: 100px;
            left: 0;
            bottom: 90px;
            right: 250px;
            overflow: auto;
            position: relative;
        }

        #board img
        {
            position: absolute;
        }
        
        #board canvas
        {
            position: absolute;
        }
        
        #areas
        {
            background-color: #ffd800;
            width: 250px;
            top: 100px;
            bottom: 900px;
            right: 0;            
        }
                        
        #toolbar
        {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 90px;
            background: url(Images/shadow-bottom.png) #6b6b6b repeat-x top;
        }

        #images li img
        {
            max-width: 120px;
            max-height: 90px;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div id="images">    
            <ul>
                <li><img src="Samples/IMG_3104.JPG" /></li>
                <li>
                <img id="image" src="apple-touch-icon-57x57-precomposed.png" />
                </li>
                <li>
                <input type="file" id="files" name="files[]" multiple />
                </li>
                <li>
                <output id="list"></output>
                </li>
            </ul>
        </div>
        <div id="areas">
            <div>
                <h2>Area 1</h2>
                <ul>
                    <li>Point 1</li>
                    <li>Point 1</li>
                </ul>
            </div>

        </div>

        <div id="board">
            <canvas id="canvas"></canvas>
            <img src="Samples/IMG_3104.JPG" />
        </div>

        

        <div id="toolbar">
        </div>
    </div>


    <script src="Scripts/jquery-1.6.4.js" type="text/javascript"></script>
	<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
	<script type="text/javascript">        !window.jQuery && document.write(unescape('%3Cscript src="Scripts/jquery-1.6.4.min.js"%3E%3C/script%3E'))</script>-->
	<!--[if lt IE 7 ]>
	<script src="Scripts/dd_belatedpng.js"></script>
	<script> DD_belatedPNG.fix('img, .png_bg');</script>
	<![endif]-->

    <script>
        $("#image").click(function () {
            $("#files").click();
            
        });
    </script>

    <script>
        function handleFileSelect(evt) {
            var files = evt.target.files; // FileList object

            // Loop through the FileList and render image files as thumbnails.
            for (var i = 0, f; f = files[i]; i++) {

                // Only process image files.
                if (!f.type.match('image.*')) {
                    continue;
                }

                var reader = new FileReader();

                // Closure to capture the file information.
                reader.onload = (function(theFile) {
                    return function(e) {
                        // Render thumbnail.
                        var span = document.createElement('span');
                        span.innerHTML = ['<img class="thumb" src="', e.target.result,
                            '" title="', theFile.name, '"/>'].join('');

                            // This line is what replaces the image with the new image
                        $("#image").attr("src", e.target.result);
                    };
                })(f);

                // Read in the image file as a data URL.
                reader.readAsDataURL(f);
            }
        }
        document.getElementById('files').addEventListener('change', handleFileSelect, false);

        $(function () {

            var canvas = $('#canvas').get(0);
            var ctx = canvas.getContext('2d');
            var w = h = canvas.width = canvas.height = 300;
            
            var points = new Array();

            canvas.addEventListener('mousemove', function (e) {
                
                canvas.width = canvas.width;

                var point = {
                    x: e.pageX - canvas.offsetLeft,
                    y: e.pageY - canvas.offsetTop
                }

                var str = 'Click to add new point.';

                ctx.fillStyle = '#3f3f3f';
                ctx.fillRect(point.x + 10, point.y + 10, 70, 20);
                ctx.fillStyle = '#fff';
                ctx.font = '18px calibri';
                ctx.fillText(str, point.x + 10, point.y + 25, 60);

                for (i = 0, f; f = points.length; i++) {
                    /*if ((point.x == points[i].x) && (point.y == points[i].y)) {
                        str = 'Click to move current point.';

                        ctx.fillStyle = '#3f3f3f';
                        ctx.fillRect(point.x + 10, point.y + 10, 70, 20);
                        ctx.fillStyle = '#fff';
                        ctx.font = 'bold 20px verdana';
                        ctx.fillText(str, point.x + 10, point.y + 25, 60);
                    }*/
                        str = 'Point: ' + i;

                        ctx.fillStyle = '#3f3f3f';
                        ctx.fillRect(points[i].x + 10, points[i].y + 10, 70, 20);
                        ctx.fillStyle = '#fff';
                        ctx.font = '18px verdana';
                        ctx.fillText(str, points[i].x + 10, points[i].y + 25, 60);
                }

                if ((point.x == points[0].x) && (point.y == points[0].y)) {
                    str = 'Click to close area.';

                    ctx.fillStyle = '#3f3f3f';
                    ctx.fillRect(point.x + 10, point.y + 10, 70, 20);
                    ctx.fillStyle = '#fff';
                    ctx.font = '18px calibri';
                    ctx.fillText(str, point.x + 10, point.y + 25, 60);
                }

            }, 0);

            canvas.addEventListener('mousedown', function (e) {
                
                canvas.width = canvas.width;

                var point = {
                    x: e.pageX - canvas.offsetLeft,
                    y: e.pageY - canvas.offsetTop
                }

                var arrayLength = points.push(point);

                var str = 'New point added.';
                ctx.fillStyle = '#3f3f3f';
                ctx.fillRect(point.x + 10, point.y + 10, 70, 20);
                ctx.fillStyle = '#fff';
                ctx.font = '18px calibri';
                ctx.fillText(str, point.x + 10, point.y + 25, 60);
            }, 0);

        });

</script>

</body>
</html>